name: Swift

on: [pull_request]
jobs:
  build:
    runs-on: macos-12

    steps:
      - uses: actions/checkout@v3
      - uses: fwal/setup-swift@2040b795e5c453c3a05fcb8316496afc8a74f192
        with:
          swift-version: "5.5"

      - name: Build
        run: swift build

      - name: Run tests
        run: swift test --enable-code-coverage

      - name: Test coverage
        uses: maxep/spm-lcov-action@0.3.0
        with:
          output-file: ./coverage/lcov.info

      - name: Updload Coverage
        uses: romeovs/lcov-reporter-action@v0.2.16
        with:
          filter-changed-files: true
          delete-old-comments: true
          title: Code Coverage
          github-token: ${{ secrets.TOKEN }}
          lcov-file: ./coverage/lcov.info
